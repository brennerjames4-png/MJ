<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MJ - Music Jam</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Permanent+Marker&family=Rock+Salt&family=Bebas+Neue&family=Special+Elite&display=swap" rel="stylesheet">
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
    --flame: #e85d26;
    --flame-dark: #c44a1c;
    --gold: #f0a500;
    --gold-dim: #c48800;
    --vinyl: #0d0d0d;
    --card: #1a1410;
    --card-hover: #2a1f18;
    --text: #f5e6d3;
    --text-dim: #a89279;
    --border: #3d2e1f;
    --neon-blue: #00d4ff;
    --purple: #9b59b6;
}

body {
    font-family: 'Special Elite', 'Courier New', monospace;
    background: var(--vinyl);
    color: var(--text);
    min-height: 100vh;
    background-image:
        radial-gradient(ellipse at 20% 50%, rgba(232,93,38,0.06) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 20%, rgba(240,165,0,0.04) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 80%, rgba(155,89,182,0.04) 0%, transparent 50%);
}

/* Noise texture overlay */
body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
}

.container {
    max-width: 860px;
    margin: 0 auto;
    padding: 20px;
    position: relative;
    z-index: 1;
}

/* --- HEADER --- */
header {
    text-align: center;
    padding: 32px 0 24px;
    border-bottom: 2px solid var(--border);
    margin-bottom: 28px;
    position: relative;
}

header::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 10%;
    right: 10%;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--flame), var(--gold), var(--flame), transparent);
}

header h1 {
    font-family: 'Anton', sans-serif;
    font-size: 4rem;
    letter-spacing: 8px;
    background: linear-gradient(180deg, var(--gold) 0%, var(--flame) 60%, #8b2500 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: none;
    filter: drop-shadow(0 2px 8px rgba(232,93,38,0.4));
    line-height: 1;
}

.subtitle {
    font-family: 'Rock Salt', cursive;
    color: var(--text-dim);
    margin-top: 8px;
    font-size: 0.85rem;
    letter-spacing: 2px;
}

.user-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin-top: 16px;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 2px;
}

.avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 2px solid var(--gold);
    box-shadow: 0 0 10px rgba(240,165,0,0.3);
}

/* --- BUTTONS --- */
.btn {
    font-family: 'Bebas Neue', sans-serif;
    background: var(--card-hover);
    color: var(--text);
    border: 1px solid var(--border);
    padding: 10px 24px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    letter-spacing: 2px;
    transition: all 0.3s;
    text-transform: uppercase;
}

.btn:hover {
    background: var(--border);
    border-color: var(--gold-dim);
    box-shadow: 0 0 12px rgba(240,165,0,0.15);
}

.btn-sm { padding: 6px 14px; font-size: 13px; }

.btn-spotify {
    background: linear-gradient(135deg, var(--flame) 0%, var(--flame-dark) 100%);
    border: none;
    color: #fff;
    font-weight: 600;
    padding: 14px 32px;
    font-size: 18px;
    letter-spacing: 3px;
    box-shadow: 0 4px 20px rgba(232,93,38,0.4);
    position: relative;
    overflow: hidden;
}

.btn-spotify::before {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
    transition: left 0.5s;
}

.btn-spotify:hover::before { left: 100%; }

.btn-spotify:hover {
    background: linear-gradient(135deg, var(--gold) 0%, var(--flame) 100%);
    box-shadow: 0 4px 30px rgba(240,165,0,0.5);
    transform: translateY(-1px);
}

/* --- HERO --- */
.hero {
    text-align: center;
    padding: 60px 20px 80px;
}

.hero h2 {
    font-family: 'Permanent Marker', cursive;
    font-size: 2.2rem;
    margin-bottom: 16px;
    color: var(--text);
    line-height: 1.3;
}

.hero p {
    color: var(--text-dim);
    margin-bottom: 32px;
    max-width: 520px;
    margin-left: auto;
    margin-right: auto;
    font-size: 0.95rem;
    line-height: 1.7;
}

.hero-tagline {
    font-family: 'Rock Salt', cursive;
    color: var(--flame);
    font-size: 0.8rem;
    margin-top: 24px;
    opacity: 0.7;
}

/* --- VINYL DIVIDER --- */
.vinyl-divider {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    margin: 20px 0;
    color: var(--text-dim);
    font-size: 12px;
    letter-spacing: 3px;
}

.vinyl-divider::before, .vinyl-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--border), transparent);
}

/* --- TABS --- */
.tabs {
    display: flex;
    gap: 0;
    margin-bottom: 28px;
    border-bottom: 2px solid var(--border);
    padding-bottom: 0;
}

.tab {
    font-family: 'Bebas Neue', sans-serif;
    background: none;
    border: none;
    color: var(--text-dim);
    padding: 14px 24px;
    cursor: pointer;
    font-size: 17px;
    letter-spacing: 3px;
    border-bottom: 3px solid transparent;
    transition: all 0.3s;
    text-transform: uppercase;
    position: relative;
}

.tab:hover {
    color: var(--text);
    background: rgba(232,93,38,0.05);
}

.tab.active {
    color: var(--flame);
    border-bottom-color: var(--flame);
    text-shadow: 0 0 20px rgba(232,93,38,0.4);
}

.tab-content { display: none; animation: fadeIn 0.3s ease; }
.tab-content.active { display: block; }

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Section headers */
.tab-content h2 {
    font-family: 'Permanent Marker', cursive;
    font-size: 1.5rem;
    margin-bottom: 20px;
    color: var(--gold);
}

/* --- SONG CARDS --- */
.song-list { display: flex; flex-direction: column; gap: 10px; }

.song-card {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 14px 16px;
    background: linear-gradient(135deg, var(--card) 0%, rgba(26,20,16,0.8) 100%);
    border-radius: 6px;
    border: 1px solid var(--border);
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
}

.song-card::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 3px;
    background: linear-gradient(180deg, var(--flame), var(--gold));
    opacity: 0;
    transition: opacity 0.3s;
}

.song-card:hover {
    background: var(--card-hover);
    border-color: var(--flame);
    box-shadow: 0 2px 20px rgba(232,93,38,0.1);
    transform: translateX(2px);
}

.song-card:hover::before { opacity: 1; }

.song-card img {
    width: 60px;
    height: 60px;
    border-radius: 4px;
    object-fit: cover;
    border: 1px solid var(--border);
    box-shadow: 0 2px 8px rgba(0,0,0,0.5);
}

.song-info { flex: 1; min-width: 0; }

.song-info .name {
    font-family: 'Bebas Neue', sans-serif;
    font-weight: 400;
    font-size: 1.15rem;
    letter-spacing: 1px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--text);
}

.song-info .artist {
    color: var(--gold-dim);
    font-size: 12px;
    margin-top: 2px;
    letter-spacing: 1px;
}

.song-info .meta {
    color: var(--text-dim);
    font-size: 11px;
    margin-top: 4px;
    font-style: italic;
}

.song-actions { display: flex; gap: 8px; flex-shrink: 0; }

.reaction-btn {
    background: var(--card);
    border: 1px solid var(--border);
    color: var(--text-dim);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 17px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.reaction-btn:hover {
    border-color: var(--flame);
    color: var(--flame);
    box-shadow: 0 0 12px rgba(232,93,38,0.3);
    transform: scale(1.1);
}

.reaction-btn.active {
    background: linear-gradient(135deg, var(--flame), var(--gold));
    border-color: var(--gold);
    color: #fff;
    box-shadow: 0 0 16px rgba(240,165,0,0.4);
}

.share-btn {
    font-family: 'Bebas Neue', sans-serif;
    background: none;
    border: 1px solid var(--flame);
    color: var(--flame);
    padding: 8px 18px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    letter-spacing: 2px;
    text-transform: uppercase;
    transition: all 0.3s;
}

.share-btn:hover {
    background: var(--flame);
    color: #fff;
    box-shadow: 0 0 16px rgba(232,93,38,0.4);
}

/* --- SEARCH --- */
.search-box {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

.search-box input {
    flex: 1;
    padding: 14px 20px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 4px;
    color: var(--text);
    font-family: 'Special Elite', monospace;
    font-size: 15px;
    outline: none;
    transition: border-color 0.3s;
}

.search-box input::placeholder { color: var(--text-dim); }

.search-box input:focus {
    border-color: var(--flame);
    box-shadow: 0 0 12px rgba(232,93,38,0.15);
}

/* --- SHARE FORM --- */
.share-form {
    margin-top: 20px;
    padding: 20px;
    background: var(--card);
    border-radius: 6px;
    border: 1px solid var(--border);
}

.share-form h3 {
    font-family: 'Bebas Neue', sans-serif;
    margin-bottom: 12px;
    font-size: 16px;
    letter-spacing: 2px;
    color: var(--gold);
}

.share-form select, .share-form textarea {
    width: 100%;
    padding: 12px;
    background: var(--vinyl);
    border: 1px solid var(--border);
    border-radius: 4px;
    color: var(--text);
    font-family: 'Special Elite', monospace;
    font-size: 14px;
    margin-bottom: 10px;
}

.share-form textarea { resize: vertical; min-height: 60px; }

/* --- COMPARE --- */
.compare-picker {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-bottom: 28px;
    font-family: 'Bebas Neue', sans-serif;
    letter-spacing: 2px;
}

.compare-picker label { color: var(--gold); }

.compare-picker select {
    flex: 1;
    padding: 12px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 4px;
    color: var(--text);
    font-family: 'Special Elite', monospace;
    font-size: 14px;
}

.compat-score {
    text-align: center;
    padding: 40px 20px;
    position: relative;
}

.compat-score::before {
    content: '';
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 180px; height: 180px;
    border-radius: 50%;
    border: 2px solid var(--flame);
    opacity: 0.15;
}

.compat-score #compat-number {
    font-family: 'Anton', sans-serif;
    font-size: 5rem;
    background: linear-gradient(180deg, var(--gold) 0%, var(--flame) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    filter: drop-shadow(0 2px 12px rgba(232,93,38,0.5));
}

.compat-score span:last-of-type {
    font-family: 'Anton', sans-serif;
    font-size: 2.5rem;
    background: linear-gradient(180deg, var(--gold) 0%, var(--flame) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.compat-score p {
    font-family: 'Rock Salt', cursive;
    color: var(--text-dim);
    margin-top: 8px;
    font-size: 0.8rem;
    letter-spacing: 2px;
}

.compare-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin-top: 24px;
}

.compare-grid h3 {
    font-family: 'Bebas Neue', sans-serif;
    color: var(--flame);
    font-size: 16px;
    letter-spacing: 2px;
    margin-bottom: 10px;
    border-bottom: 1px solid var(--border);
    padding-bottom: 6px;
}

.compare-grid ul {
    list-style: none;
    color: var(--text-dim);
    font-size: 13px;
}

.compare-grid li {
    padding: 6px 0;
    border-bottom: 1px solid rgba(61,46,31,0.5);
    transition: color 0.2s;
}

.compare-grid li:hover { color: var(--text); }

/* --- UTILITIES --- */
.hidden { display: none; }

.loading {
    color: var(--text-dim);
    text-align: center;
    padding: 32px;
    font-style: italic;
    letter-spacing: 1px;
}

a.spotify-link {
    color: var(--gold-dim);
    text-decoration: none;
    font-size: 11px;
    letter-spacing: 1px;
    transition: color 0.2s;
}

a.spotify-link:hover {
    color: var(--gold);
    text-decoration: underline;
}

/* --- SCROLLBAR --- */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--vinyl); }
::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover { background: var(--flame); }

/* --- RESPONSIVE --- */
@media (max-width: 600px) {
    header h1 { font-size: 2.8rem; letter-spacing: 4px; }
    .hero h2 { font-size: 1.5rem; }
    .tabs { flex-wrap: wrap; }
    .tab { padding: 10px 14px; font-size: 14px; letter-spacing: 1px; }
    .song-card { padding: 10px; gap: 10px; }
    .song-card img { width: 48px; height: 48px; }
    .compare-picker { flex-wrap: wrap; }
}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MUSIC JAM</h1>
            <p class="subtitle">Turn it up to eleven</p>
            {% if logged_in %}
            <div class="user-bar">
                {% if user.image_url %}
                <img src="{{ user.image_url }}" alt="avatar" class="avatar">
                {% endif %}
                <span>{{ user.display_name }}</span>
                <a href="/logout" class="btn btn-sm">Logout</a>
            </div>
            {% endif %}
        </header>

        {% if not logged_in %}
        <div class="hero">
            <h2>Share the riffs. Compare the taste. Rock together.</h2>
            <p>Plug in your Spotify, send your favorite tracks to your crew, rate each other's picks, and find out if your taste is classic gold or garage noise.</p>
            <a href="/login" class="btn btn-spotify">Plug In With Spotify</a>
            <p class="hero-tagline">~ where good taste meets loud opinions ~</p>
        </div>
        {% else %}
        <nav class="tabs">
            <button class="tab active" data-tab="feed">The Feed</button>
            <button class="tab" data-tab="share">Drop a Track</button>
            <button class="tab" data-tab="compare">Face Off</button>
            <button class="tab" data-tab="my-top">My Bangers</button>
        </nav>

        <!-- FEED TAB -->
        <section id="feed" class="tab-content active">
            <h2>The Setlist</h2>
            <div id="feed-list" class="song-list">
                <p class="loading">Tuning the guitars...</p>
            </div>
        </section>

        <!-- SHARE TAB -->
        <section id="share" class="tab-content">
            <h2>Drop a Track</h2>
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Search for a banger...">
                <button id="search-btn" class="btn">Search</button>
            </div>
            <div id="search-results" class="song-list"></div>

            <div id="share-form" class="share-form hidden">
                <h3>Send it to:</h3>
                <select id="share-to"></select>
                <textarea id="share-message" placeholder="Drop a message with the track..."></textarea>
                <button id="send-btn" class="btn btn-spotify">Send It</button>
            </div>
        </section>

        <!-- COMPARE TAB -->
        <section id="compare" class="tab-content">
            <h2>Face Off</h2>
            <div class="compare-picker">
                <label>Battle against:</label>
                <select id="compare-user"></select>
                <button id="compare-btn" class="btn">Let's Go</button>
            </div>
            <div id="compare-results" class="hidden">
                <div class="compat-score">
                    <span id="compat-number">0</span><span>%</span>
                    <p>rock compatibility</p>
                </div>
                <div class="compare-grid">
                    <div>
                        <h3>Shared Legends</h3>
                        <ul id="shared-artists"></ul>
                    </div>
                    <div>
                        <h3>Your Frequencies</h3>
                        <ul id="my-genres"></ul>
                    </div>
                    <div>
                        <h3>Their Frequencies</h3>
                        <ul id="their-genres"></ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- MY TOP TAB -->
        <section id="my-top" class="tab-content">
            <h2>My Bangers</h2>
            <div id="top-tracks-list" class="song-list">
                <p class="loading">Loading the vinyl collection...</p>
            </div>
        </section>
        {% endif %}
    </div>

    {% if logged_in %}
    <script>
        const MY_ID = "{{ user.id }}";
    </script>
    <script>
// --- Tab switching ---
document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        const content = document.getElementById(tab.dataset.tab);
        content.classList.add('active');
        content.style.animation = 'none';
        content.offsetHeight;
        content.style.animation = null;
    });
});

// --- Helpers ---
async function api(url, opts = {}) {
    const resp = await fetch(url, {
        headers: { 'Content-Type': 'application/json' },
        ...opts,
    });
    if (!resp.ok) throw new Error(`API error ${resp.status}`);
    return resp.json();
}

function songCard(track, actions = '') {
    return `
        <div class="song-card" data-track-id="${track.id || ''}">
            ${track.album_image ? `<img src="${track.album_image}" alt="">` : ''}
            <div class="song-info">
                <div class="name">${track.name || track.track_name || ''}</div>
                <div class="artist">${track.artist || track.artist_name || ''}</div>
                ${track.meta ? `<div class="meta">${track.meta}</div>` : ''}
                ${track.spotify_url ? `<a class="spotify-link" href="${track.spotify_url}" target="_blank">Open in Spotify</a>` : ''}
            </div>
            <div class="song-actions">${actions}</div>
        </div>
    `;
}

// --- Load feed ---
async function loadFeed() {
    const el = document.getElementById('feed-list');
    try {
        const songs = await api('/api/shared');
        if (songs.length === 0) {
            el.innerHTML = '<p class="loading">No tracks shared yet. Be the first to drop one!</p>';
            return;
        }
        el.innerHTML = songs.map(s => {
            const isMine = s.from_user_id === MY_ID;
            const direction = isMine ? `You sent` : `From ${s.from_name}`;
            const meta = `${direction} ${s.message ? '- "' + s.message + '"' : ''} - ${new Date(s.created_at).toLocaleDateString()}`;
            const likeActive = s.my_reaction === 'like' ? 'active' : '';
            const dislikeActive = s.my_reaction === 'dislike' ? 'active' : '';
            return songCard(
                { ...s, name: s.track_name, artist: s.artist_name, meta },
                `<button class="reaction-btn ${likeActive}" onclick="react(${s.id}, 'like', this)" title="Encore!">&#x1F918;</button>
                 <button class="reaction-btn ${dislikeActive}" onclick="react(${s.id}, 'dislike', this)" title="Next!">&#x1F44E;</button>`
            );
        }).join('');
    } catch (e) {
        el.innerHTML = '<p class="loading">Could not load the setlist.</p>';
    }
}

async function react(songId, reaction, btn) {
    await api('/api/react', {
        method: 'POST',
        body: JSON.stringify({ shared_song_id: songId, reaction }),
    });
    const parent = btn.parentElement;
    parent.querySelectorAll('.reaction-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

// --- Search & share ---
let selectedTrack = null;

document.getElementById('search-btn').addEventListener('click', async () => {
    const q = document.getElementById('search-input').value.trim();
    if (!q) return;
    const results = await api(`/api/search?q=${encodeURIComponent(q)}`);
    document.getElementById('search-results').innerHTML = results.map(t =>
        songCard(t, `<button class="share-btn" onclick='selectTrack(${JSON.stringify(t).replace(/'/g, "&#39;")})'>Share</button>`)
    ).join('');
});

document.getElementById('search-input').addEventListener('keydown', e => {
    if (e.key === 'Enter') document.getElementById('search-btn').click();
});

window.selectTrack = async function(track) {
    selectedTrack = track;
    document.getElementById('share-form').classList.remove('hidden');
    const users = await api('/api/users');
    const sel = document.getElementById('share-to');
    sel.innerHTML = users.map(u => `<option value="${u.id}">${u.display_name}</option>`).join('');
    if (users.length === 0) sel.innerHTML = '<option disabled>No one else has plugged in yet</option>';
};

document.getElementById('send-btn').addEventListener('click', async () => {
    if (!selectedTrack) return;
    const to = document.getElementById('share-to').value;
    const msg = document.getElementById('share-message').value;
    await api('/api/share', {
        method: 'POST',
        body: JSON.stringify({
            to_user_id: to,
            track_id: selectedTrack.id,
            track_name: selectedTrack.name,
            artist_name: selectedTrack.artist,
            album_image: selectedTrack.album_image,
            preview_url: selectedTrack.preview_url,
            spotify_url: selectedTrack.spotify_url,
            message: msg,
        }),
    });
    document.getElementById('share-form').classList.add('hidden');
    document.getElementById('share-message').value = '';
    selectedTrack = null;
    alert('Track sent! Rock on.');
    document.querySelector('[data-tab="feed"]').click();
    loadFeed();
});

// --- Compare ---
async function loadCompareUsers() {
    try {
        const users = await api('/api/users');
        const sel = document.getElementById('compare-user');
        sel.innerHTML = users.map(u => `<option value="${u.id}">${u.display_name}</option>`).join('');
        if (users.length === 0) sel.innerHTML = '<option disabled>No challengers yet</option>';
    } catch (e) {}
}

document.getElementById('compare-btn').addEventListener('click', async () => {
    const otherId = document.getElementById('compare-user').value;
    if (!otherId) return;
    try {
        const data = await api(`/api/compare/${otherId}`);
        document.getElementById('compare-results').classList.remove('hidden');
        document.getElementById('compat-number').textContent = data.compatibility_score;
        document.getElementById('shared-artists').innerHTML = data.shared_artists.length
            ? data.shared_artists.map(a => `<li>${a}</li>`).join('')
            : '<li>No shared legends found</li>';
        document.getElementById('my-genres').innerHTML = data.my_top_genres.map(g => `<li>${g}</li>`).join('');
        document.getElementById('their-genres').innerHTML = data.their_top_genres.map(g => `<li>${g}</li>`).join('');
    } catch (e) {
        alert('Could not compare. Make sure both rockers are plugged in.');
    }
});

// --- My top tracks ---
async function loadTopTracks() {
    const el = document.getElementById('top-tracks-list');
    try {
        const tracks = await api('/api/me/top-tracks');
        el.innerHTML = tracks.length
            ? tracks.map((t, i) => songCard({ ...t, meta: `#${i + 1}` })).join('')
            : '<p class="loading">No top tracks yet. Get listening!</p>';
    } catch (e) {
        el.innerHTML = '<p class="loading">Could not load your bangers.</p>';
    }
}

// --- Init ---
loadFeed();
loadTopTracks();
loadCompareUsers();
    </script>
    {% endif %}
</body>
</html>
